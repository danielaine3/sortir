<!DOCTYPE html>
<html>
  <head>
    <title>Simple Map</title>
    <meta name="viewport" content="initial-scale=1.0">
    <meta charset="utf-8">
    <style>
      /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
      #map, #map2, #map3 {
        height: 50%;
      }
      /* Optional: Makes the sample page fill the window. */
      html, body {
        height: 100%;
        margin: 0;
        padding: 0;
      }
    </style>
  </head>

  <body>

    <div id="map"></div>

    <div class="container">
      <h1>Eventful Search</h1>

      <div id="event-view"></div>
      
        <form id="search-form">

          <label for="event-input">Enter location of the event!</label>
          <input type="text" id="location-input"><br> 

          <label for="sel1">Enter date of the event</label>
            <select class="form-control" id="date-input">
              <option value=Today>Today</option>
                <option value=ThisWeek>This Week</option>
                <option value=NextWeek>Next week</option>
            </select> 

          <input id="find-event" type="submit" value="Event Search">
        </form>

      <div id="eventDate">Date = </div>

      <div id="eventName">Name = </div>  

      <div id="moreInfo">URL = </div>

    </div>


    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.2.1/jquery.min.js"></script>

    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyApu_fsoWF0jqAI5bZVZ5hiWvibSNrFmms&callback=initMap"

    async defer></script>

    <script type="text/javascript">

      var mapLatitude=[];
      var mapLongitude=[];
      var dateSelector=[];
      var moreInfo=[];
      var eventName=[];
      var coords=[];
      var map;
      var latLng;
      var marker;


      // click function for AJAX Call
      $("#find-event").on("click", function(event) {

        // prevent event default behavior
        event.preventDefault();

        //wait until the data from Ajax loads and then show the map

        setTimeout(initMap, 4000);
       

        // store search input in variable
        var location = $("#location-input").val();

        var date = $("#date-input").val();

        //check if the date uploads correctly

        alert(date);

        // construct our URL using location and date determined by user

        var queryURL = "https://cors-anywhere.herokuapp.com/api.eventful.com/json/events/search?app_key=54CPdHQQ4wTp4fM7&location=" + location+ "&date="+ date + "&limit=10";

        // queryURL using $ajax

        $.ajax({
          url: queryURL,
          method: "GET"
        }).done(function(response) {

          for (var i=0; i<3; i++){

            console.log(JSON.parse(response));
            
            //Find Longitude and Latitude

            mapLatitude[i] = JSON.parse(response).events.event[i].latitude;
            console.log("new lat = " + mapLatitude[i]);
            mapLatitude.push(mapLatitude[i]);

            mapLongitude[i] = JSON.parse(response).events.event[i].longitude;
            console.log("new long = " + mapLongitude[i]);
            mapLongitude.push(mapLongitude[i]);

            //coords[parseInt(mapLatitude[i]), parseInt(mapLongitude[i])]
            //coords.push(coords[i,i]);



            //Print the date when the event starts

            dateSelector[i] = JSON.parse(response).events.event[i].start_time;

            $("#eventDate").text(dateSelector[i]);

            //Print URL

            moreInfo[i]= JSON.parse(response).events.event[i].venue_url;

            $("#moreInfo").text(moreInfo[i]);

            //Print Name of the event

            eventName[i]= JSON.parse(response).events.event[i].title;

            $("#eventName").text(eventName[i]);

            console.log("inside scope = " + mapLatitude[i]);

            //console.log(mapLatitude);
            //console.log(mapLongitude);

          }

        });

        //console array of Lattitude and Longitude

        console.log(mapLatitude);
        console.log(mapLongitude);

        initMap();


      });

     

//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX




//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX

function initMap() {
          map = new google.maps.Map(document.getElementById('map'), {
            zoom: 10,
            center: new google.maps.LatLng(mapLatitude[1], mapLongitude[1]),
            //mapTypeId: 'terrain'
          });

          for (var i=0; i<3; i++){
          latLng = new google.maps.LatLng(mapLatitude[i], mapLongitude[i]);
          marker = new google.maps.Marker({
              position: latLng,
              map: map
          });
          }
        }
        
    
//XXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXXX
      

      //UMN mapLatitude = 44.9460782;

      //UMN mapLongitude = -93.0953525;


      /*

      for (var i = 0; i < 10; i++) {
      console.log("outside scope = " + mapLatitude[i]);
      };
    
      //Map with the marker
      //-------------------

      var marker =[];

      function initMap() {

        var uluru = {lat: parseInt(mapLatitude[1]), lng: parseInt(mapLongitude[1])};

        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 6,
          center: uluru
        });

        marker[1] = new google.maps.Marker({
          position: uluru,
          map: map
        });
      }

      //Importing Data into Maps 
      //--------------------------     

      function initMap() {
        map = new google.maps.Map(document.getElementById('map'), {
          zoom: 2,
          center: new google.maps.LatLng(2.8,-187.3),
          mapTypeId: 'terrain'
        });

        // Create a <script> tag and set the USGS URL as the source.
        //var script = document.createElement('script');
        // This example uses a local copy of the GeoJSON stored at
        // http://earthquake.usgs.gov/earthquakes/feed/v1.0/summary/2.5_week.geojsonp
        //script.src = 'https://developers.google.com/maps/documentation/javascript/examples/json/earthquake_GeoJSONP.js';
        //document.getElementsByTagName('head')[0].appendChild(script);
      

        // Loop through the results array and place a marker for each
        // set of coordinates.

        window.eqfeed_callback = function(results) {
          for (var i = 0; i < results.features.length; i++) {
            var coords = results.features[i].geometry.coordinates;
            var latLng = new google.maps.LatLng(coords[1],coords[0]);
            var marker = new google.maps.Marker({
              position: latLng,
              map: map
          });
        }
      }

      */
    </script>

  </body>
</html>